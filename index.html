<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pattern System</title>
<style>
table{border-collapse:collapse;font-size:12px}
td,th{border:1px solid #999;padding:4px;text-align:center}
.blank{background:#eee;cursor:pointer}
.circle{border:3px solid red;border-radius:50%}
#checks{background:#e8ffe8;margin:8px;padding:8px}
</style>
</head>
<body>

<h2>Pattern System</h2>
<input type="file" id="csvFile">
<button onclick="addRow()">Add Row</button>
<br><br>
<table id="tbl"></table>

<h3>✔ Check Lines</h3>
<div id="checks">Click blank cell to generate pattern</div>

<script>
// ===== FAMILY DATA =====
const families={
"12":["12","17","21","26","62","67","71","76"],
"13":["13","18","31","36","63","68","81","86"],
"14":["14","19","41","46","64","69","91","96"],
"15":["01","06","10","15","51","56","60","65"],
"23":["23","28","32","37","73","78","82","87"],
"24":["24","29","42","47","74","79","92","97"],
"25":["02","07","20","25","52","57","70","75"],
"34":["34","39","43","48","84","89","93","98"],
"35":["03","08","30","35","53","58","80","85"],
"45":["04","09","40","45","54","59","90","95"],
"HR":["05","16","27","38","49","50","61","72","83","94"],
"FR":["00","11","22","33","44","55","66","77","88","99"]
};

function norm(v){
 if(v==="**"||v==="") return "**";
 v=String(v);
 return v.length==1?"0"+v:v;
}
function getFamily(v){
 for(let k in families) if(families[k].includes(v)) return k;
 return "NA";
}

// ===== SAMPLE DATA =====
let data=[
["51","91","41","57","19","95"],
["05","90","74","06","19","63"],
["90","34","82","09","28","19"],
["72","34","21","32","21","42"],
["58","84","00","67","06","98"],
["03","82","29","90","14","66"],
["02","40","92","85","00","88"],
["39","94","33","58","11","63"],
["91","69","60","71","85","20"],
["95","28","11","29","28","18"],
["47","83","45","80","33","18"],
["96","25","78","59","30","94"],
["**","**","**","**","**","**"]
];
data=data.map(r=>r.map(norm));

// ===== RENDER =====
function draw(){
 let t="<tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>";
 data.forEach((r,ri)=>{
  t+="<tr>";
  r.forEach((c,ci)=>{
    if(c=="**") t+=`<td class="blank" onclick="makePattern(${ci})">**</td>`;
    else t+=`<td id="c-${ri}-${ci}">${c}</td>`;
  });
  t+="</tr>";
 });
 document.getElementById("tbl").innerHTML=t;
}
draw();

// ===== MAIN LOGIC =====
function makePattern(col){
 clearCircles();

 let picked=[];
 for(let i=data.length-1;i>=0 && picked.length<3;i--){
   let v=data[i][col];
   if(v!="**"){
     picked.push(getFamily(v));
   }
 }
 if(picked.length<3 || picked.includes("NA")){
   document.getElementById("checks").innerHTML="Invalid pattern (NA or less rows)";
   return;
 }
 picked=picked.reverse(); // top to bottom

 // search
 for(let i=0;i<=data.length-3;i++){
   let f1=getFamily(data[i][col]);
   let f2=getFamily(data[i+1][col]);
   let f3=getFamily(data[i+2][col]);
   if(f1==picked[0] && f2==picked[1] && f3==picked[2]){
     mark(i,col); mark(i+1,col); mark(i+2,col);
   }
 }

 document.getElementById("checks").innerHTML=
   "Picked families: "+picked.join(" → ");
}

function mark(r,c){
 let el=document.getElementById(`c-${r}-${c}`);
 if(el) el.classList.add("circle");
}
function clearCircles(){
 document.querySelectorAll(".circle").forEach(x=>x.classList.remove("circle"));
}

// ===== ADD ROW =====
function addRow(){
 let row=[];
 for(let i=0;i<6;i++) row.push("**");
 data.push(row);
 draw();
}

// ===== CSV UPLOAD =====
document.getElementById("csvFile").addEventListener("change",e=>{
 let f=e.target.files[0];
 let r=new FileReader();
 r.onload=()=>{
  let lines=r.result.trim().split(/\r?\n/);
  data=lines.map(l=>l.split(",").map(x=>norm(x.trim())));
  draw();
 };
 r.readAsText(f);
});
</script>
</body>
</html>
