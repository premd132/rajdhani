<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Advance Pattern System</title>
<style>
body{font-family:Arial}
table{border-collapse:collapse;font-size:13px}
td,th{border:1px solid #999;padding:5px;text-align:center;font-weight:600}
.blank{background:#eee;cursor:pointer}
#ai{background:#eef;padding:10px;margin-top:10px;font-weight:600}
button{margin:5px}
</style>
</head>
<body>

<h2>Advance Pattern System (Monâ€“Sat)</h2>
<input type="file" id="csv">
<button onclick="addRow()">Add Row</button>
<button onclick="saveData()">Save</button>
<table id="tbl"></table>

<h3>ðŸ¤– Advance AI Suggestion</h3>
<div id="ai">Blank cell par click karo</div>

<script>
/* ===== FAMILY ===== */
const families={
"12":["12","17","21","26","62","67","71","76"],
"13":["13","18","31","36","63","68","81","86"],
"14":["14","19","41","46","64","69","91","96"],
"15":["01","06","10","15","51","56","60","65"],
"23":["23","28","32","37","73","78","82","87"],
"24":["24","29","42","47","74","79","92","97"],
"25":["02","07","20","25","52","57","70","75"],
"34":["34","39","43","48","84","89","93","98"],
"35":["03","08","30","35","53","58","80","85"],
"45":["04","09","40","45","54","59","90","95"],
"HR":["05","16","27","38","49","50","61","72","83","94"],
"FR":["00","11","22","33","44","55","66","77","88","99"]
};
function fam(v){for(let k in families) if(families[k].includes(v)) return k; return "NA";}
function norm(v){if(v==""||v=="**")return "**";v=String(v);return v.length==1?"0"+v:v;}

/* ===== DATA ===== */
let data=JSON.parse(localStorage.getItem("pdata")||"null");
if(!data){
 data=[
 ["51","91","41","57","19","22"],
 ["05","90","74","06","19","88"],
 ["90","34","82","09","28","15"],
 ["46","33","91","15","22","67"],
 ["**","**","**","**","**","**"]
 ];
}
data=data.map(r=>r.map(norm));
let targetCol=null;

/* ===== DRAW ===== */
function draw(){
 let h="<tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>";
 data.forEach((r,ri)=>{
  h+="<tr>";
  r.forEach((c,ci)=>{
   if(c=="**")
    h+=`<td class="blank" onclick="makeAdvance(${ri},${ci})" contenteditable oninput="edit(${ri},${ci},this)">**</td>`;
   else
    h+=`<td contenteditable oninput="edit(${ri},${ci},this)">${c}</td>`;
  });
  h+="</tr>";
 });
 tbl.innerHTML=h;
}
draw();

function edit(r,c,el){data[r][c]=norm(el.innerText.trim());}
function addRow(){data.push(["","","","","",""].map(norm));draw();}
function saveData(){localStorage.setItem("pdata",JSON.stringify(data));alert("Saved");}

csv.onchange=e=>{
 let fr=new FileReader();
 fr.onload=()=>{
  data=fr.result.trim().split("\n").map(r=>r.split(",").map(v=>{
   v=v.trim(); if(v==""||v=="*"||v=="**") return "**"; return norm(v);
  }));
  draw();
 };
 fr.readAsText(e.target.files[0]);
};

/* ===== ADVANCE PATTERN ===== */
/*
 Template:
 A = (r-4, Mon=0)
 B = (r-2, Wed=2)
 C = (r-2, Tue=1)  // left of B
 Result = next row same column as blank
*/
function makeAdvance(r,c){
 targetCol=c;
 if(r<4){ ai.innerHTML="Kam data hai"; return; }

 let A=data[r-4][0];
 let B=data[r-2][2];
 let C=data[r-2][1];
 if(A=="**"||B=="**"||C=="**"){ ai.innerHTML="Reference blank hai"; return; }

 let key=fam(A)+"-"+fam(B)+"-"+fam(C);

 // Mine old data
 let results=[];
 for(let i=4;i<data.length-1;i++){
  let A1=data[i-4][0];
  let B1=data[i-2][2];
  let C1=data[i-2][1];
  if(A1=="**"||B1=="**"||C1=="**") continue;
  let k1=fam(A1)+"-"+fam(B1)+"-"+fam(C1);
  if(k1==key){
   let v=data[i+1][targetCol];
   if(v!="**") results.push(v);
  }
 }

 if(results.length==0){
  ai.innerHTML="Is structure ka purana record nahi mila";
  return;
 }

 // Count
 let count={};
 results.forEach(v=>count[v]=(count[v]||0)+1);
 let sorted=Object.entries(count).sort((a,b)=>b[1]-a[1]);

 let html="Advance Structure Match<br>";
 html+="Key: "+key+"<br><br>";
 html+="Top Guess:<br>";
 sorted.slice(0,3).forEach(x=>{
  html+=x[0]+" ("+x[1]+" baar)<br>";
 });
 ai.innerHTML=html;
}
</script>
</body>
</html>
