<!DOCTYPE html><html>
<head>
<meta charset="UTF-8">
<title>Pattern AI Table</title>
<style>
body{font-family:Arial;background:#f5f5f5}
button{margin:4px;padding:6px 10px}
input{padding:5px}
table{border-collapse:collapse;margin-top:10px;background:#fff}
th,td{border:1px solid #999;padding:6px;text-align:center;font-weight:600;min-width:50px}
.blank{background:#eee;cursor:pointer}
.circle{border:2px solid red;border-radius:50%}
.line{background:#d0f0ff}
.popup{position:fixed;top:10%;left:10%;right:10%;bottom:10%;background:#fff;border:2px solid #333;padding:10px;overflow:auto;display:none;z-index:9}
.popup h3{margin:0 0 10px}
.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.4);display:none;z-index:8}
#resultBox{margin-top:10px;padding:10px;background:#fff;border:1px solid #999}
</style>
</head>
<body>
<h2>AI Pattern Table</h2>
<button onclick="addRow()">Add Row</button>
<input type="file" accept=".csv" onchange="loadCSV(event)">
<button onclick="saveData()">Save</button>
<button onclick="loadData()">Load</button>
<button onclick="makeCheckLines()">Make 3 Check Lines</button>
<button onclick="finalResult()">Final Result</button><table id="tbl">
<thead><tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th></tr></thead>
<tbody></tbody>
</table><div id="resultBox"></div><div class="overlay" id="ov"></div>
<div class="popup" id="pop">
  <h3>Sequence (Real Record)</h3>
  <div id="popContent"></div>
  <button onclick="closePop()">Close</button>
</div><script>
// ---- Families Example ----
const families={
"12":["12","17","21","26","62","67","71","76"],
"13":["13","18","31","36","63","68","81","86"],
"14":["14","19","41","46","64","69","91","96"],
"15":["01","06","10","15","51","56","60","65"],
"23":["23","28","32","37","73","78","82","87"],
"24":["24","29","42","47","74","79","92","97"],
"25":["02","07","20","25","52","57","70","75"],
"34":["34","39","43","48","84","89","93","98"],
"35":["03","08","30","35","53","58","80","85"],
"45":["04","09","40","45","54","59","90","95"],
"Half Red":["05","16","27","38","49","50","61","72","83","94"],
"Full Red":["00","11","22","33","44","55","66","77","88","99"]};

function fam(v){for(let k in families) if(families[k].includes(v)) return k; return "NA";}
function palti(v){return v[1]+v[0];}
function norm(v){if(v==""||v=="**")return "**";v=String(v);return v.length==1?"0"+v:v;}
function smartMatch(a,b){if(a=="**"||b=="**")return false;if(a===b)return true;if(palti(a)===b||palti(b)===a)return true;return fam(a)===fam(b);}  

// ---- Table ----
const tb=document.querySelector("#tbl tbody");
function addRow(arr){
 let tr=document.createElement("tr");
 for(let i=0;i<5;i++){
  let td=document.createElement("td");
  td.contentEditable=true;
  td.oninput=()=>{ td.innerText=norm(td.innerText.trim()); saveData(); };
  td.innerText = arr ? (arr[i] ? norm(arr[i].trim()) : "") : "";
  tr.appendChild(td);
 }
 tb.appendChild(tr); saveData();
}
addRow();
window.addEventListener('load', loadData);

// ---- CSV ----
function loadCSV(e){
 let f=e.target.files[0]; if(!f) return;
 let r=new FileReader();
 r.onload=()=>{
  tb.innerHTML="";
  tb.innerHTML="";
  let lines = r.result.split(/
?
/);
  lines.forEach(l=>{
    if(l.trim()!==""){
      let parts = l.split(",");
      addRow(parts);
    }
  });
   saveData();
 };
 r.readAsText(f);
});
 };
 r.readAsText(f);
}

// ---- Save/Load ----
function saveData(){
 let data=[...tb.rows].map(r=>[...r.cells].map(c=>c.innerText));
 localStorage.setItem("tblData",JSON.stringify(data));
 alert("Saved");
}
function loadData(){
 let d=JSON.parse(localStorage.getItem("tblData")||"[]");
 tb.innerHTML="";d.forEach(r=>addRow(r));
}

// ---- Check Lines ----
let checkCells=[];
function makeCheckLines(){
 clearMarks();
 checkCells=[];
 let rows=[...tb.rows];
 if(rows.length<3)return;
 for(let i=0;i<3;i++){
  let r=rows[rows.length-1-i];
  let c=r.cells[i%5];
  c.classList.add("line");
  c.onclick=()=>showSequence(c.innerText);
  checkCells.push(c.innerText);
 }
}

function clearMarks(){
 [...tb.querySelectorAll("td")].forEach(td=>{td.classList.remove("circle","line");td.onclick=null;});
}

// ---- Popup Sequence ----
function showSequence(v){
 let seq=[];
 [...tb.rows].forEach(r=>[...r.cells].forEach(c=>{if(smartMatch(norm(c.innerText),v))seq.push(norm(c.innerText));}));
 let box=document.getElementById("popContent");
 box.innerHTML="";
 seq.forEach(s=>{let d=document.createElement("div");d.textContent=s;d.style.display="inline-block";d.style.margin="5px";d.style.padding="6px";d.style.border="2px solid red";d.style.borderRadius="50%";box.appendChild(d);});
 // mark in real table
 [...tb.rows].forEach(r=>[...r.cells].forEach(c=>{if(seq.includes(norm(c.innerText)))c.classList.add("circle");}));
 document.getElementById("ov").style.display="block";
 document.getElementById("pop").style.display="block";
}
function closePop(){document.getElementById("ov").style.display="none";document.getElementById("pop").style.display="none";}

// ---- Final Result ----
function finalResult(){
 let flat=[...tb.rows].flatMap(r=>[...r.cells].map(c=>norm(c.innerText))).filter(v=>v!="**"&&v!="");
 let count={};flat.forEach(v=>{count[v]=(count[v]||0)+1;});
 let sorted=Object.entries(count).sort((a,b)=>b[1]-a[1]);
 let top6=sorted.slice(0,6).map(x=>x[0]);
 let single={};top6.forEach(j=>{j.split("").forEach(d=>single[d]=(single[d]||0)+1);});
 let top3=Object.entries(single).sort((a,b)=>b[1]-a[1]).slice(0,3).map(x=>x[0]);
 document.getElementById("resultBox").innerHTML=
  "<b>Top 6 Jodi:</b> "+top6.join(", ")+"<br><b>Top 3 Single Ank:</b> "+top3.join(", ");
}
</script></body>
</html>
